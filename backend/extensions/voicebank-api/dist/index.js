import e from"fs";import t,{join as n}from"path";import r from"zlib";import o from"crypto";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var a={exports:{}},s={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24},c={};!function(e){const t={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function n(e){return function(...t){return t.length&&(e=e.replace(/\{(\d)\}/g,(e,n)=>t[n]||"")),new Error("ADM-ZIP: "+e)}}for(const r of Object.keys(t))e[r]=n(t[r])}(c);const f=e,l=t,u=s,d=c,E="object"==typeof process&&"win32"===process.platform,m=e=>"object"==typeof e&&null!==e,h=new Uint32Array(256).map((e,t)=>{for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;return t>>>0});function I(e){this.sep=l.sep,this.fs=f,m(e)&&m(e.fs)&&"function"==typeof e.fs.statSync&&(this.fs=e.fs)}var g=I;I.prototype.makeDir=function(e){const t=this;!function(e){let n=e.split(t.sep)[0];e.split(t.sep).forEach(function(e){if(e&&":"!==e.substr(-1,1)){var r;n+=t.sep+e;try{r=t.fs.statSync(n)}catch(e){t.fs.mkdirSync(n)}if(r&&r.isFile())throw d.FILE_IN_THE_WAY(`"${n}"`)}})}(e)},I.prototype.writeFileTo=function(e,t,n,r){const o=this;if(o.fs.existsSync(e)){if(!n)return!1;if(o.fs.statSync(e).isDirectory())return!1}var i,a=l.dirname(e);o.fs.existsSync(a)||o.makeDir(a);try{i=o.fs.openSync(e,"w",438)}catch(t){o.fs.chmodSync(e,438),i=o.fs.openSync(e,"w",438)}if(i)try{o.fs.writeSync(i,t,0,t.length,0)}finally{o.fs.closeSync(i)}return o.fs.chmodSync(e,r||438),!0},I.prototype.writeFileToAsync=function(e,t,n,r,o){"function"==typeof r&&(o=r,r=void 0);const i=this;i.fs.exists(e,function(a){if(a&&!n)return o(!1);i.fs.stat(e,function(n,s){if(a&&s.isDirectory())return o(!1);var c=l.dirname(e);i.fs.exists(c,function(n){n||i.makeDir(c),i.fs.open(e,"w",438,function(n,a){n?i.fs.chmod(e,438,function(){i.fs.open(e,"w",438,function(n,a){i.fs.write(a,t,0,t.length,0,function(){i.fs.close(a,function(){i.fs.chmod(e,r||438,function(){o(!0)})})})})}):a?i.fs.write(a,t,0,t.length,0,function(){i.fs.close(a,function(){i.fs.chmod(e,r||438,function(){o(!0)})})}):i.fs.chmod(e,r||438,function(){o(!0)})})})})})},I.prototype.findFiles=function(e){const t=this;return function e(n,r,o){"boolean"==typeof r&&(o=r,r=void 0);let i=[];return t.fs.readdirSync(n).forEach(function(a){const s=l.join(n,a),c=t.fs.statSync(s);r&&!r.test(s)||i.push(l.normalize(s)+(c.isDirectory()?t.sep:"")),c.isDirectory()&&o&&(i=i.concat(e(s,r,o)))}),i}(e,void 0,!0)},I.prototype.findFilesAsync=function(e,t){const n=this;let r=[];n.fs.readdir(e,function(o,i){if(o)return t(o);let a=i.length;if(!a)return t(null,r);i.forEach(function(o){o=l.join(e,o),n.fs.stat(o,function(e,i){if(e)return t(e);i&&(r.push(l.normalize(o)+(i.isDirectory()?n.sep:"")),i.isDirectory()?n.findFilesAsync(o,function(e,n){if(e)return t(e);r=r.concat(n),--a||t(null,r)}):--a||t(null,r))})})})},I.prototype.getAttributes=function(){},I.prototype.setAttributes=function(){},I.crc32update=function(e,t){return h[255&(e^t)]^e>>>8},I.crc32=function(e){"string"==typeof e&&(e=Buffer.from(e,"utf8"));let t=e.length,n=-1;for(let r=0;r<t;)n=I.crc32update(n,e[r++]);return~n>>>0},I.methodToString=function(e){switch(e){case u.STORED:return"STORED ("+e+")";case u.DEFLATED:return"DEFLATED ("+e+")";default:return"UNSUPPORTED ("+e+")"}},I.canonical=function(e){if(!e)return"";const t=l.posix.normalize("/"+e.split("\\").join("/"));return l.join(".",t)},I.zipnamefix=function(e){if(!e)return"";const t=l.posix.normalize("/"+e.split("\\").join("/"));return l.posix.join(".",t)},I.findLast=function(e,t){if(!Array.isArray(e))throw new TypeError("arr is not array");for(let n=(e.length>>>0)-1;n>=0;n--)if(t(e[n],n,e))return e[n]},I.sanitize=function(e,t){e=l.resolve(l.normalize(e));for(var n=t.split("/"),r=0,o=n.length;r<o;r++){var i=l.normalize(l.join(e,n.slice(r,o).join(l.sep)));if(0===i.indexOf(e))return i}return l.normalize(l.join(e,l.basename(t)))},I.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):"string"==typeof e?t(e):Buffer.alloc(0)},I.readBigUInt64LE=function(e,t){var n=Buffer.from(e.slice(t,t+8));return n.swap64(),parseInt(`0x${n.toString("hex")}`)},I.fromDOS2Date=function(e){return new Date(1980+(e>>25&127),Math.max((e>>21&15)-1,0),Math.max(e>>16&31,1),e>>11&31,e>>5&63,(31&e)<<1)},I.fromDate2DOS=function(e){let t=0,n=0;return e.getFullYear()>1979&&(t=(e.getFullYear()-1980&127)<<9|e.getMonth()+1<<5|e.getDate(),n=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1),t<<16|n},I.isWin=E,I.crcTable=h;const p=t;var N={efs:!0,encode:e=>Buffer.from(e,"utf8"),decode:e=>e.toString("utf8")};a.exports=g,a.exports.Constants=s,a.exports.Errors=c,a.exports.FileAttr=function(e,{fs:t}){var n=e||"",r={directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0},o=null;return n&&t.existsSync(n)?(o=t.statSync(n),r.directory=o.isDirectory(),r.mtime=o.mtime,r.atime=o.atime,r.executable=!!(73&o.mode),r.readonly=!(128&o.mode),r.hidden="."===p.basename(n)[0]):console.warn("Invalid path: "+n),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:n,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}},a.exports.decoder=N;var y=a.exports,L={},D=y,C=D.Constants,_=y,S=_.Constants;L.EntryHeader=function(){var e=20,t=10,n=0,r=0,o=0,i=0,a=0,s=0,c=0,f=0,l=0,u=0,d=0,E=0,m=0;e|=D.isWin?2560:768,n|=C.FLG_EFS;const h={extraLen:0},I=e=>Math.max(0,e)>>>0;return o=D.fromDate2DOS(new Date),{get made(){return e},set made(t){e=t},get version(){return t},set version(e){t=e},get flags(){return n},set flags(e){n=e},get flags_efs(){return(n&C.FLG_EFS)>0},set flags_efs(e){e?n|=C.FLG_EFS:n&=~C.FLG_EFS},get flags_desc(){return(n&C.FLG_DESC)>0},set flags_desc(e){e?n|=C.FLG_DESC:n&=~C.FLG_DESC},get method(){return r},set method(e){switch(e){case C.STORED:this.version=10;case C.DEFLATED:default:this.version=20}r=e},get time(){return D.fromDOS2Date(this.timeval)},set time(e){this.timeval=D.fromDate2DOS(e)},get timeval(){return o},set timeval(e){o=I(e)},get timeHighByte(){return e=o>>>8,255&Math.max(0,e);var e},get crc(){return i},set crc(e){i=I(e)},get compressedSize(){return a},set compressedSize(e){a=I(e)},get size(){return s},set size(e){s=I(e)},get fileNameLength(){return c},set fileNameLength(e){c=e},get extraLength(){return f},set extraLength(e){f=e},get extraLocalLength(){return h.extraLen},set extraLocalLength(e){h.extraLen=e},get commentLength(){return l},set commentLength(e){l=e},get diskNumStart(){return u},set diskNumStart(e){u=I(e)},get inAttr(){return d},set inAttr(e){d=I(e)},get attr(){return E},set attr(e){E=I(e)},get fileAttr(){return(E||0)>>16&4095},get offset(){return m},set offset(e){m=I(e)},get encrypted(){return(n&C.FLG_ENC)===C.FLG_ENC},get centralHeaderSize(){return C.CENHDR+c+f+l},get realDataOffset(){return m+C.LOCHDR+h.fnameLen+h.extraLen},get localHeader(){return h},loadLocalHeaderFromBinary:function(e){var t=e.slice(m,m+C.LOCHDR);if(t.readUInt32LE(0)!==C.LOCSIG)throw D.Errors.INVALID_LOC();h.version=t.readUInt16LE(C.LOCVER),h.flags=t.readUInt16LE(C.LOCFLG),h.method=t.readUInt16LE(C.LOCHOW),h.time=t.readUInt32LE(C.LOCTIM),h.crc=t.readUInt32LE(C.LOCCRC),h.compressedSize=t.readUInt32LE(C.LOCSIZ),h.size=t.readUInt32LE(C.LOCLEN),h.fnameLen=t.readUInt16LE(C.LOCNAM),h.extraLen=t.readUInt16LE(C.LOCEXT);const n=m+C.LOCHDR+h.fnameLen,r=n+h.extraLen;return e.slice(n,r)},loadFromBinary:function(h){if(h.length!==C.CENHDR||h.readUInt32LE(0)!==C.CENSIG)throw D.Errors.INVALID_CEN();e=h.readUInt16LE(C.CENVEM),t=h.readUInt16LE(C.CENVER),n=h.readUInt16LE(C.CENFLG),r=h.readUInt16LE(C.CENHOW),o=h.readUInt32LE(C.CENTIM),i=h.readUInt32LE(C.CENCRC),a=h.readUInt32LE(C.CENSIZ),s=h.readUInt32LE(C.CENLEN),c=h.readUInt16LE(C.CENNAM),f=h.readUInt16LE(C.CENEXT),l=h.readUInt16LE(C.CENCOM),u=h.readUInt16LE(C.CENDSK),d=h.readUInt16LE(C.CENATT),E=h.readUInt32LE(C.CENATX),m=h.readUInt32LE(C.CENOFF)},localHeaderToBinary:function(){var e=Buffer.alloc(C.LOCHDR);return e.writeUInt32LE(C.LOCSIG,0),e.writeUInt16LE(t,C.LOCVER),e.writeUInt16LE(n,C.LOCFLG),e.writeUInt16LE(r,C.LOCHOW),e.writeUInt32LE(o,C.LOCTIM),e.writeUInt32LE(i,C.LOCCRC),e.writeUInt32LE(a,C.LOCSIZ),e.writeUInt32LE(s,C.LOCLEN),e.writeUInt16LE(c,C.LOCNAM),e.writeUInt16LE(h.extraLen,C.LOCEXT),e},centralHeaderToBinary:function(){var h=Buffer.alloc(C.CENHDR+c+f+l);return h.writeUInt32LE(C.CENSIG,0),h.writeUInt16LE(e,C.CENVEM),h.writeUInt16LE(t,C.CENVER),h.writeUInt16LE(n,C.CENFLG),h.writeUInt16LE(r,C.CENHOW),h.writeUInt32LE(o,C.CENTIM),h.writeUInt32LE(i,C.CENCRC),h.writeUInt32LE(a,C.CENSIZ),h.writeUInt32LE(s,C.CENLEN),h.writeUInt16LE(c,C.CENNAM),h.writeUInt16LE(f,C.CENEXT),h.writeUInt16LE(l,C.CENCOM),h.writeUInt16LE(u,C.CENDSK),h.writeUInt16LE(d,C.CENATT),h.writeUInt32LE(E,C.CENATX),h.writeUInt32LE(m,C.CENOFF),h},toJSON:function(){const o=function(e){return e+" bytes"};return{made:e,version:t,flags:n,method:D.methodToString(r),time:this.time,crc:"0x"+i.toString(16).toUpperCase(),compressedSize:o(a),size:o(s),fileNameLength:o(c),extraLength:o(f),commentLength:o(l),diskNumStart:u,inAttr:d,attr:E,offset:m,centralHeaderSize:o(C.CENHDR+c+f+l)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}},L.MainHeader=function(){var e=0,t=0,n=0,r=0,o=0;return{get diskEntries(){return e},set diskEntries(n){e=t=n},get totalEntries(){return t},set totalEntries(n){t=e=n},get size(){return n},set size(e){n=e},get offset(){return r},set offset(e){r=e},get commentLength(){return o},set commentLength(e){o=e},get mainHeaderSize(){return S.ENDHDR+o},loadFromBinary:function(i){if((i.length!==S.ENDHDR||i.readUInt32LE(0)!==S.ENDSIG)&&(i.length<S.ZIP64HDR||i.readUInt32LE(0)!==S.ZIP64SIG))throw _.Errors.INVALID_END();i.readUInt32LE(0)===S.ENDSIG?(e=i.readUInt16LE(S.ENDSUB),t=i.readUInt16LE(S.ENDTOT),n=i.readUInt32LE(S.ENDSIZ),r=i.readUInt32LE(S.ENDOFF),o=i.readUInt16LE(S.ENDCOM)):(e=_.readBigUInt64LE(i,S.ZIP64SUB),t=_.readBigUInt64LE(i,S.ZIP64TOT),n=_.readBigUInt64LE(i,S.ZIP64SIZE),r=_.readBigUInt64LE(i,S.ZIP64OFF),o=0)},toBinary:function(){var i=Buffer.alloc(S.ENDHDR+o);return i.writeUInt32LE(S.ENDSIG,0),i.writeUInt32LE(0,4),i.writeUInt16LE(e,S.ENDSUB),i.writeUInt16LE(t,S.ENDTOT),i.writeUInt32LE(n,S.ENDSIZ),i.writeUInt32LE(r,S.ENDOFF),i.writeUInt16LE(o,S.ENDCOM),i.fill(" ",S.ENDHDR),i},toJSON:function(){return{diskEntries:e,totalEntries:t,size:n+" bytes",offset:function(e,t){let n=e.toString(16).toUpperCase();for(;n.length<t;)n="0"+n;return"0x"+n}(r,4),commentLength:o}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}};var O={};const T=+(process.versions?process.versions.node:"").split(".")[0]||0;const{randomFillSync:F}=o,A=c,w=new Uint32Array(256).map((e,t)=>{for(let e=0;e<8;e++)1&t?t=t>>>1^3988292384:t>>>=1;return t>>>0}),R=(e,t)=>Math.imul(e,t)>>>0,v=(e,t)=>w[255&(e^t)]^e>>>8,U=()=>"function"==typeof F?F(Buffer.alloc(12)):U.node();U.node=()=>{const e=Buffer.alloc(12),t=e.length;for(let n=0;n<t;n++)e[n]=256*Math.random()&255;return e};const P={genSalt:U};function B(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let e=0;e<t.length;e++)this.updateKeys(t[e])}B.prototype.updateKeys=function(e){const t=this.keys;return t[0]=v(t[0],e),t[1]+=255&t[0],t[1]=R(t[1],134775813)+1,t[2]=v(t[2],t[1]>>>24),e},B.prototype.next=function(){const e=(2|this.keys[2])>>>0;return R(e,1^e)>>8&255};var x={decrypt:function(e,t,n){if(!e||!Buffer.isBuffer(e)||e.length<12)return Buffer.alloc(0);const r=function(e){const t=new B(e);return function(e){const n=Buffer.alloc(e.length);let r=0;for(let o of e)n[r++]=t.updateKeys(o^t.next());return n}}(n),o=r(e.slice(0,12)),i=8&~t.flags?t.crc>>>24:t.timeHighByte;if(o[11]!==i)throw A.WRONG_PASSWORD();return r(e.slice(12))},encrypt:function(e,t,n,r=!1){null==e&&(e=Buffer.alloc(0)),Buffer.isBuffer(e)||(e=Buffer.from(e.toString()));const o=function(e){const t=new B(e);return function(e,n,r=0){n||(n=Buffer.alloc(e.length));for(let o of e){const e=t.next();n[r++]=o^e,t.updateKeys(o)}return n}}(n),i=P.genSalt();i[11]=t.crc>>>24&255,r&&(i[10]=t.crc>>>16&255);const a=Buffer.alloc(e.length+12);return o(i,a),o(e,a,12)},_salter:function(e){Buffer.isBuffer(e)&&e.length>=12?P.genSalt=function(){return e.slice(0,12)}:P.genSalt="node"===e?U.node:U}};O.Deflater=function(e){var t=r,n={chunkSize:1024*(parseInt(e.length/1024)+1)};return{deflate:function(){return t.deflateRawSync(e,n)},deflateAsync:function(r){var o=t.createDeflateRaw(n),i=[],a=0;o.on("data",function(e){i.push(e),a+=e.length}),o.on("end",function(){var e=Buffer.alloc(a),t=0;e.fill(0);for(var n=0;n<i.length;n++){var o=i[n];o.copy(e,t),t+=o.length}r&&r(e)}),o.end(e)}}},O.Inflater=function(e,t){var n=r;const o=T>=15&&t>0?{maxOutputLength:t}:{};return{inflate:function(){return n.inflateRawSync(e,o)},inflateAsync:function(t){var r=n.createInflateRaw(o),i=[],a=0;r.on("data",function(e){i.push(e),a+=e.length}),r.on("end",function(){var e=Buffer.alloc(a),n=0;e.fill(0);for(var r=0;r<i.length;r++){var o=i[r];o.copy(e,n),n+=o.length}t&&t(e)}),r.end(e)}}},O.ZipCrypto=x;var b=y,Z=L,z=b.Constants,H=O,M=function(e,t){var n=new Z.EntryHeader,r=Buffer.alloc(0),o=Buffer.alloc(0),i=!1,a=null,s=Buffer.alloc(0),c=Buffer.alloc(0),f=!0;const l=e,u="object"==typeof l.decoder?l.decoder:b.decoder;function d(){return t&&t instanceof Uint8Array?(c=n.loadLocalHeaderFromBinary(t),t.slice(n.realDataOffset,n.realDataOffset+n.compressedSize)):Buffer.alloc(0)}function E(e){if(n.flags_desc){const r={},o=n.realDataOffset+n.compressedSize;if(t.readUInt32LE(o)==z.LOCSIG||t.readUInt32LE(o)==z.CENSIG)throw b.Errors.DESCRIPTOR_NOT_EXIST();if(t.readUInt32LE(o)==z.EXTSIG)r.crc=t.readUInt32LE(o+z.EXTCRC),r.compressedSize=t.readUInt32LE(o+z.EXTSIZ),r.size=t.readUInt32LE(o+z.EXTLEN);else{if(19280!==t.readUInt16LE(o+12))throw b.Errors.DESCRIPTOR_UNKNOWN();r.crc=t.readUInt32LE(o+z.EXTCRC-4),r.compressedSize=t.readUInt32LE(o+z.EXTSIZ-4),r.size=t.readUInt32LE(o+z.EXTLEN-4)}if(r.compressedSize!==n.compressedSize||r.size!==n.size||r.crc!==n.crc)throw b.Errors.DESCRIPTOR_FAULTY();if(b.crc32(e)!==r.crc)return!1}else if(b.crc32(e)!==n.localHeader.crc)return!1;return!0}function m(e,t,o){if(void 0===t&&"string"==typeof e&&(o=e,e=void 0),i)return e&&t&&t(Buffer.alloc(0),b.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var a=d();if(0===a.length)return e&&t&&t(a),a;if(n.encrypted){if("string"!=typeof o&&!Buffer.isBuffer(o))throw b.Errors.INVALID_PASS_PARAM();a=H.ZipCrypto.decrypt(a,n,o)}var s=Buffer.alloc(n.size);switch(n.method){case b.Constants.STORED:if(a.copy(s),E(s))return e&&t&&t(s),s;throw e&&t&&t(s,b.Errors.BAD_CRC()),b.Errors.BAD_CRC();case b.Constants.DEFLATED:var c=new H.Inflater(a,n.size);if(!e){if(c.inflate(s).copy(s,0),!E(s))throw b.Errors.BAD_CRC(`"${u.decode(r)}"`);return s}c.inflateAsync(function(e){e.copy(e,0),t&&(E(e)?t(e):t(e,b.Errors.BAD_CRC()))});break;default:throw e&&t&&t(Buffer.alloc(0),b.Errors.UNKNOWN_METHOD()),b.Errors.UNKNOWN_METHOD()}}function h(e,r){if((!a||!a.length)&&Buffer.isBuffer(t))return e&&r&&r(d()),d();if(a.length&&!i){var o;switch(n.method){case b.Constants.STORED:return n.compressedSize=n.size,o=Buffer.alloc(a.length),a.copy(o),e&&r&&r(o),o;default:case b.Constants.DEFLATED:var s=new H.Deflater(a);if(!e){var c=s.deflate();return n.compressedSize=c.length,c}s.deflateAsync(function(e){o=Buffer.alloc(e.length),n.compressedSize=e.length,e.copy(o),r&&r(o)}),s=null}}else{if(!e||!r)return Buffer.alloc(0);r(Buffer.alloc(0))}}function I(e,t){return(e.readUInt32LE(t+4)<<4)+e.readUInt32LE(t)}function g(e){var t,r,o,i;e.length>=z.EF_ZIP64_SCOMP&&(t=I(e,z.EF_ZIP64_SUNCOMP),n.size===z.EF_ZIP64_OR_32&&(n.size=t)),e.length>=z.EF_ZIP64_RHO&&(r=I(e,z.EF_ZIP64_SCOMP),n.compressedSize===z.EF_ZIP64_OR_32&&(n.compressedSize=r)),e.length>=z.EF_ZIP64_DSN&&(o=I(e,z.EF_ZIP64_RHO),n.offset===z.EF_ZIP64_OR_32&&(n.offset=o)),e.length>=z.EF_ZIP64_DSN+4&&(i=e.readUInt32LE(z.EF_ZIP64_DSN),n.diskNumStart===z.EF_ZIP64_OR_16&&(n.diskNumStart=i))}return f=!!u.hasOwnProperty("efs")&&u.efs,{get entryName(){return u.decode(r)},get rawEntryName(){return r},set entryName(e){var t=(r=b.toBuffer(e,u.encode))[r.length-1];i=47===t||92===t,n.fileNameLength=r.length},get efs(){return"function"==typeof f?f(this.entryName):f},get extra(){return s},set extra(e){s=e,n.extraLength=e.length,function(e){try{for(var t,n,r,o=0;o+4<e.length;)t=e.readUInt16LE(o),o+=2,n=e.readUInt16LE(o),o+=2,r=e.slice(o,o+n),o+=n,z.ID_ZIP64===t&&g(r)}catch(e){throw b.Errors.EXTRA_FIELD_PARSE_ERROR()}}(e)},get comment(){return u.decode(o)},set comment(e){if(o=b.toBuffer(e,u.encode),n.commentLength=o.length,o.length>65535)throw b.Errors.COMMENT_TOO_LONG()},get name(){var e=u.decode(r);return i?e.substr(e.length-1).split("/").pop():e.split("/").pop()},get isDirectory(){return i},getCompressedData:function(){return h(!1,null)},getCompressedDataAsync:function(e){h(!0,e)},setData:function(e){a=b.toBuffer(e,b.decoder.encode),!i&&a.length?(n.size=a.length,n.method=b.Constants.DEFLATED,n.crc=b.crc32(e),n.changed=!0):n.method=b.Constants.STORED},getData:function(e){return n.changed?a:m(!1,null,e)},getDataAsync:function(e,t){n.changed?e(a):m(!0,e,t)},set attr(e){n.attr=e},get attr(){return n.attr},set header(e){n.loadFromBinary(e)},get header(){return n},packCentralHeader:function(){n.flags_efs=this.efs,n.extraLength=s.length;var e=n.centralHeaderToBinary(),t=b.Constants.CENHDR;return r.copy(e,t),t+=r.length,s.copy(e,t),t+=n.extraLength,o.copy(e,t),e},packLocalHeader:function(){let e=0;n.flags_efs=this.efs,n.extraLocalLength=c.length;const t=n.localHeaderToBinary(),o=Buffer.alloc(t.length+r.length+n.extraLocalLength);return t.copy(o,e),e+=t.length,r.copy(o,e),e+=r.length,c.copy(o,e),e+=c.length,o},toJSON:function(){const e=function(e){return"<"+(e&&e.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:n.toJSON(),compressedData:e(t),data:e(a)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}};const k=M,G=L,j=y;const V=y,X=t,K=M,W=function(e,t){var n=[],r={},o=Buffer.alloc(0),i=new G.MainHeader,a=!1;const s=new Set,c=t,{noSort:f,decoder:l}=c;function u(){if(a=!0,r={},i.diskEntries>(e.length-i.offset)/j.Constants.CENHDR)throw j.Errors.DISK_ENTRY_TOO_LARGE();n=new Array(i.diskEntries);for(var t=i.offset,o=0;o<n.length;o++){var f=t,l=new k(c,e);l.header=e.slice(f,f+=j.Constants.CENHDR),l.entryName=e.slice(f,f+=l.header.fileNameLength),l.header.extraLength&&(l.extra=e.slice(f,f+=l.header.extraLength)),l.header.commentLength&&(l.comment=e.slice(f,f+l.header.commentLength)),t+=l.header.centralHeaderSize,n[o]=l,r[l.entryName]=l}s.clear(),function(){const e=new Set;for(const t of Object.keys(r)){const n=t.split("/");if(n.pop(),n.length)for(let t=0;t<n.length;t++){const r=n.slice(0,t+1).join("/")+"/";e.add(r)}}for(const t of e)if(!(t in r)){const e=new k(c);e.entryName=t,e.attr=16,e.temporary=!0,n.push(e),r[e.entryName]=e,s.add(e)}}()}function d(){n.length>1&&!f&&n.sort((e,t)=>e.entryName.toLowerCase().localeCompare(t.entryName.toLowerCase()))}return e?function(t){var n=e.length-j.Constants.ENDHDR,r=Math.max(0,n-65535),a=r,s=e.length,f=-1,l=0;"boolean"==typeof c.trailingSpace&&c.trailingSpace&&(r=0);for(;n>=a;n--)if(80===e[n])if(e.readUInt32LE(n)!==j.Constants.ENDSIG)if(e.readUInt32LE(n)!==j.Constants.END64SIG){if(e.readUInt32LE(n)===j.Constants.ZIP64SIG){f=n,s=n+j.readBigUInt64LE(e,n+j.Constants.ZIP64SIZE)+j.Constants.ZIP64LEAD;break}}else a=r;else f=n,l=n,s=n+j.Constants.ENDHDR,a=n-j.Constants.END64HDR;if(-1==f)throw j.Errors.INVALID_FORMAT();i.loadFromBinary(e.slice(f,s)),i.commentLength&&(o=e.slice(l+j.Constants.ENDHDR));t&&u()}(c.readEntries):a=!0,{get entries(){return a||u(),n.filter(e=>!s.has(e))},get comment(){return l.decode(o)},set comment(e){o=j.toBuffer(e,l.encode),i.commentLength=o.length},getEntryCount:function(){return a?n.length:i.diskEntries},forEach:function(e){this.entries.forEach(e)},getEntry:function(e){return a||u(),r[e]||null},setEntry:function(e){a||u(),n.push(e),r[e.entryName]=e,i.totalEntries=n.length},deleteFile:function(e,t=!0){a||u();const n=r[e];this.getEntryChildren(n,t).map(e=>e.entryName).forEach(this.deleteEntry)},deleteEntry:function(e){a||u();const t=r[e],o=n.indexOf(t);o>=0&&(n.splice(o,1),delete r[e],i.totalEntries=n.length)},getEntryChildren:function(e,t=!0){if(a||u(),"object"==typeof e){if(e.isDirectory&&t){const t=[],r=e.entryName;for(const e of n)e.entryName.startsWith(r)&&t.push(e);return t}return[e]}return[]},getChildCount:function(e){if(e&&e.isDirectory){const t=this.getEntryChildren(e);return t.includes(e)?t.length-1:t.length}return 0},compressToBuffer:function(){a||u(),d();const t=[],n=[];let r=0,s=0;i.size=0,i.offset=0;let c=0;for(const e of this.entries){const o=e.getCompressedData();e.header.offset=s;const a=e.packLocalHeader(),f=a.length+o.length;s+=f,t.push(a),t.push(o);const l=e.packCentralHeader();n.push(l),i.size+=l.length,r+=f+l.length,c++}r+=i.mainHeaderSize,i.offset=s,i.totalEntries=c,s=0;const f=Buffer.alloc(r);for(const e of t)e.copy(f,s),s+=e.length;for(const e of n)e.copy(f,s),s+=e.length;const l=i.toBinary();return o&&o.copy(l,j.Constants.ENDHDR),l.copy(f,s),e=f,a=!1,f},toAsyncBuffer:function(t,n,r,s){try{a||u(),d();const n=[],c=[];let f=0,l=0,E=0;i.size=0,i.offset=0;const m=function(u){if(u.length>0){const e=u.shift(),t=e.entryName+e.extra.toString();r&&r(t),e.getCompressedDataAsync(function(r){s&&s(t),e.header.offset=l;const o=e.packLocalHeader(),a=o.length+r.length;l+=a,n.push(o),n.push(r);const d=e.packCentralHeader();c.push(d),i.size+=d.length,f+=a+d.length,E++,m(u)})}else{f+=i.mainHeaderSize,i.offset=l,i.totalEntries=E,l=0;const r=Buffer.alloc(f);n.forEach(function(e){e.copy(r,l),l+=e.length}),c.forEach(function(e){e.copy(r,l),l+=e.length});const s=i.toBinary();o&&o.copy(s,j.Constants.ENDHDR),s.copy(r,l),e=r,a=!1,t(r)}};m(Array.from(this.entries))}catch(e){n(e)}}}},Y=(...e)=>V.findLast(e,e=>"boolean"==typeof e),J=(...e)=>V.findLast(e,e=>"string"==typeof e),$={noSort:!1,readEntries:!1,method:V.Constants.NONE,fs:null};var q=function(e,t){let n=null;const r=Object.assign(Object.create(null),$);e&&"object"==typeof e&&(e instanceof Uint8Array||(Object.assign(r,e),e=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(e)&&(n=e,r.method=V.Constants.BUFFER,e=void 0)),Object.assign(r,t);const o=new V(r);if("object"==typeof r.decoder&&"function"==typeof r.decoder.encode&&"function"==typeof r.decoder.decode||(r.decoder=V.decoder),e&&"string"==typeof e){if(!o.fs.existsSync(e))throw V.Errors.INVALID_FILENAME();r.method=V.Constants.FILE,r.filename=e,n=o.fs.readFileSync(e)}const i=new W(n,r),{canonical:a,sanitize:s,zipnamefix:c}=V;function f(e){var t;if(e&&i&&("string"==typeof e&&(t=i.getEntry(X.posix.normalize(e))),"object"==typeof e&&void 0!==e.entryName&&void 0!==e.header&&(t=i.getEntry(e.entryName)),t))return t;return null}function l(e){const{join:t,normalize:n,sep:r}=X.posix;return t(".",n(r+e.split("\\").join(r)+r))}function u(e){return e instanceof RegExp?(t=e,function(e){return t.test(e)}):"function"!=typeof e?()=>!0:e;var t}const d=(e,t)=>{let n=t.slice(-1);return n=n===o.sep?o.sep:"",X.relative(e,t)+n};return{readFile:function(e,t){var n=f(e);return n&&n.getData(t)||null},childCount:function(e){const t=f(e);if(t)return i.getChildCount(t)},readFileAsync:function(e,t){var n=f(e);n?n.getDataAsync(t):t(null,"getEntry failed for:"+e)},readAsText:function(e,t){var n=f(e);if(n){var r=n.getData();if(r&&r.length)return r.toString(t||"utf8")}return""},readAsTextAsync:function(e,t,n){var r=f(e);r?r.getDataAsync(function(e,r){r?t(e,r):e&&e.length?t(e.toString(n||"utf8")):t("")}):t("")},deleteFile:function(e,t=!0){var n=f(e);n&&i.deleteFile(n.entryName,t)},deleteEntry:function(e){var t=f(e);t&&i.deleteEntry(t.entryName)},addZipComment:function(e){i.comment=e},getZipComment:function(){return i.comment||""},addZipEntryComment:function(e,t){var n=f(e);n&&(n.comment=t)},getZipEntryComment:function(e){var t=f(e);return t&&t.comment||""},updateFile:function(e,t){var n=f(e);n&&n.setData(t)},addLocalFile:function(e,t,n,r){if(!o.fs.existsSync(e))throw V.Errors.FILE_NOT_FOUND(e);{t=t?l(t):"";const i=X.win32.basename(X.win32.normalize(e));t+=n||i;const a=o.fs.statSync(e),s=a.isFile()?o.fs.readFileSync(e):Buffer.alloc(0);a.isDirectory()&&(t+=o.sep),this.addFile(t,s,r,a)}},addLocalFileAsync:function(e,t){e="object"==typeof e?e:{localPath:e};const n=X.resolve(e.localPath),{comment:r}=e;let{zipPath:i,zipName:a}=e;const s=this;o.fs.stat(n,function(e,c){if(e)return t(e,!1);i=i?l(i):"";const f=X.win32.basename(X.win32.normalize(n));if(i+=a||f,c.isFile())o.fs.readFile(n,function(e,n){return e?t(e,!1):(s.addFile(i,n,r,c),setImmediate(t,void 0,!0))});else if(c.isDirectory())return i+=o.sep,s.addFile(i,Buffer.alloc(0),r,c),setImmediate(t,void 0,!0)})},addLocalFolder:function(e,t,n){if(n=u(n),t=t?l(t):"",e=X.normalize(e),!o.fs.existsSync(e))throw V.Errors.FILE_NOT_FOUND(e);{const r=o.findFiles(e),i=this;if(r.length)for(const o of r){const r=X.join(t,d(e,o));n(r)&&i.addLocalFile(o,X.dirname(r))}}},addLocalFolderAsync:function(e,t,n,r){r=u(r),n=n?l(n):"",e=X.normalize(e);var i=this;o.fs.open(e,"r",function(a){if(a&&"ENOENT"===a.code)t(void 0,V.Errors.FILE_NOT_FOUND(e));else if(a)t(void 0,a);else{var s=o.findFiles(e),c=-1,f=function(){if((c+=1)<s.length){var a=s[c],l=d(e,a).split("\\").join("/");l=l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),r(l)?o.fs.stat(a,function(e,r){e&&t(void 0,e),r.isFile()?o.fs.readFile(a,function(e,o){e?t(void 0,e):(i.addFile(n+l,o,"",r),f())}):(i.addFile(n+l+"/",Buffer.alloc(0),"",r),f())}):process.nextTick(()=>{f()})}else t(!0,void 0)};f()}})},addLocalFolderAsync2:function(e,t){const n=this;e="object"==typeof e?e:{localPath:e},localPath=X.resolve(l(e.localPath));let{zipPath:r,filter:i,namefix:a}=e;var s;i instanceof RegExp?(s=i,i=function(e){return s.test(e)}):"function"!=typeof i&&(i=function(){return!0}),r=r?l(r):"","latin1"==a&&(a=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),"function"!=typeof a&&(a=e=>e);const c=e=>X.join(r,a(d(localPath,e))),f=e=>X.win32.basename(X.win32.normalize(a(e)));o.fs.open(localPath,"r",function(e){e&&"ENOENT"===e.code?t(void 0,V.Errors.FILE_NOT_FOUND(localPath)):e?t(void 0,e):o.findFilesAsync(localPath,function(e,r){if(e)return t(e);(r=r.filter(e=>i(c(e)))).length||t(void 0,!1),setImmediate(r.reverse().reduce(function(e,t){return function(r,o){if(r||!1===o)return setImmediate(e,r,!1);n.addLocalFileAsync({localPath:t,zipPath:X.dirname(c(t)),zipName:f(t)},e)}},t))})})},addLocalFolderPromise:function(e,t){return new Promise((n,r)=>{this.addLocalFolderAsync2(Object.assign({localPath:e},t),(e,t)=>{e&&r(e),t&&n(this)})})},addFile:function(e,t,n,a){let s=f(e=c(e));const l=null!=s;l||(s=new K(r),s.entryName=e),s.comment=n||"";const u="object"==typeof a&&a instanceof o.fs.Stats;u&&(s.header.time=a.mtime);var d=s.isDirectory?16:0;let E=s.isDirectory?16384:32768;return E|=u?4095&a.mode:"number"==typeof a?4095&a:s.isDirectory?493:420,d=(d|E<<16)>>>0,s.attr=d,s.setData(t),l||i.setEntry(s),s},getEntries:function(e){return i.password=e,i?i.entries:[]},getEntry:function(e){return f(e)},getEntryCount:function(){return i.getEntryCount()},forEach:function(e){return i.forEach(e)},extractEntryTo:function(e,t,n,r,c,l){r=Y(!1,r),c=Y(!1,c),n=Y(!0,n),l=J(c,l);var u=f(e);if(!u)throw V.Errors.NO_ENTRY();var d=a(u.entryName),E=s(t,l&&!u.isDirectory?l:n?d:X.basename(d));if(u.isDirectory)return i.getEntryChildren(u).forEach(function(e){if(e.isDirectory)return;var i=e.getData();if(!i)throw V.Errors.CANT_EXTRACT_FILE();var f=a(e.entryName),l=s(t,n?f:X.basename(f));const u=c?e.header.fileAttr:void 0;o.writeFileTo(l,i,r,u)}),!0;var m=u.getData(i.password);if(!m)throw V.Errors.CANT_EXTRACT_FILE();if(o.fs.existsSync(E)&&!r)throw V.Errors.CANT_OVERRIDE();const h=c?e.header.fileAttr:void 0;return o.writeFileTo(E,m,r,h),!0},test:function(e){if(!i)return!1;for(var t in i.entries)try{if(t.isDirectory)continue;if(!i.entries[t].getData(e))return!1}catch(e){return!1}return!0},extractAllTo:function(e,t,n,r){if(n=Y(!1,n),r=J(n,r),t=Y(!1,t),!i)throw V.Errors.NO_ZIP();i.entries.forEach(function(i){var c=s(e,a(i.entryName));if(i.isDirectory)return void o.makeDir(c);var f=i.getData(r);if(!f)throw V.Errors.CANT_EXTRACT_FILE();const l=n?i.header.fileAttr:void 0;o.writeFileTo(c,f,t,l);try{o.fs.utimesSync(c,i.header.time,i.header.time)}catch(e){throw V.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(e,t,n,r){if(r=((...e)=>V.findLast(e,e=>"function"==typeof e))(t,n,r),n=Y(!1,n),t=Y(!1,t),!r)return new Promise((r,o)=>{this.extractAllToAsync(e,t,n,function(e){e?o(e):r(this)})});if(!i)return void r(V.Errors.NO_ZIP());e=X.resolve(e);const c=t=>s(e,X.normalize(a(t.entryName))),f=(e,t)=>new Error(e+': "'+t+'"'),l=[],u=[];i.entries.forEach(e=>{e.isDirectory?l.push(e):u.push(e)});for(const e of l){const t=c(e),i=n?e.header.fileAttr:void 0;try{o.makeDir(t),i&&o.fs.chmodSync(t,i),o.fs.utimesSync(t,e.header.time,e.header.time)}catch(e){r(f("Unable to create folder",t))}}u.reverse().reduce(function(r,i){return function(c){if(c)r(c);else{const c=X.normalize(a(i.entryName)),l=s(e,c);i.getDataAsync(function(e,a){if(a)r(a);else if(e){const a=n?i.header.fileAttr:void 0;o.writeFileToAsync(l,e,t,a,function(e){e||r(f("Unable to write file",l)),o.fs.utimes(l,i.header.time,i.header.time,function(e){e?r(f("Unable to set times",l)):r()})})}else r(V.Errors.CANT_EXTRACT_FILE())})}}},r)()},writeZip:function(e,t){if(1===arguments.length&&"function"==typeof e&&(t=e,e=""),!e&&r.filename&&(e=r.filename),e){var n=i.compressToBuffer();if(n){var a=o.writeFileTo(e,n,!0);"function"==typeof t&&t(a?null:new Error("failed"),"")}}},writeZipPromise:function(e,t){const{overwrite:n,perm:i}=Object.assign({overwrite:!0},t);return new Promise((t,a)=>{!e&&r.filename&&(e=r.filename),e||a("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(r=>{o.writeFileToAsync(e,r,n,i,e=>e?t(e):a("ADM-ZIP: Wasn't able to write zip file"))},a)})},toBufferPromise:function(){return new Promise((e,t)=>{i.toAsyncBuffer(e,t)})},toBuffer:function(e,t,n,r){return"function"==typeof e?(i.toAsyncBuffer(e,t,n,r),null):i.compressToBuffer()}}},Q=i(q);function ee(e,{services:t,database:r,getSchema:o}){const{ItemsService:i}=t;e.get("/",(e,t)=>{t.json({message:"Voicebank API is working!"})}),e.get("/:voicebankName/:fileName",async(e,t)=>{try{const{voicebankName:a,fileName:s}=e.params,c=await o({database:r}),f=new i("voicebanks",{schema:c,knex:r,accountability:null}),l=await f.readByQuery({filter:{name:{_eq:a}},fields:["*","sample_files.*"]});if(!l||0===l.length)return t.status(404).json({error:`Voicebank "${a}" not found`});const u=l[0];if(!u.sample_files)return t.status(404).json({error:"No sample files found for this voicebank"});const d=u.sample_files;if(!d||!d.filename_disk)return t.status(404).json({error:"ZIP file not found"});const E=n(process.cwd(),"uploads"),m=n(E,d.filename_disk),h=new Q(m).getEntries();let I=null;for(const e of h)if(!e.isDirectory){const t=n("/",e.entryName).split("/").pop().toLowerCase();if(t===s.toLowerCase()){I={name:n("/",e.entryName).split("/").pop(),path:e.entryName,size:e.header.size,buffer:e.getData()};break}}if(!I)return t.status(404).json({error:`File "${s}" not found in voicebank`});const g=I.name.toLowerCase().split(".").pop();let p="application/octet-stream";"wav"===g?p="audio/wav":"mp3"===g?p="audio/mpeg":"ogg"===g?p="audio/ogg":"flac"===g&&(p="audio/flac");const N=encodeURIComponent(I.name);return t.setHeader("Content-Type",p),t.setHeader("Content-Disposition",`inline; filename*=UTF-8''${N}`),t.setHeader("Content-Length",I.size),t.setHeader("Cache-Control","public, max-age=31536000"),t.send(I.buffer)}catch(e){return console.error("Error extracting audio file:",e),t.status(500).json({error:"Failed to extract audio file",details:e.message})}}),e.get("/:voicebankName",async(e,t)=>{try{const{voicebankName:a}=e.params,s=await o({database:r}),c=new i("voicebanks",{schema:s,knex:r,accountability:null}),f=await c.readByQuery({filter:{name:{_eq:a}},fields:["*","sample_files.*"]});if(!f||0===f.length)return t.status(404).json({error:`Voicebank "${a}" not found`});const l=f[0];if(!l.sample_files)return t.status(404).json({error:"No sample files found for this voicebank"});const u=l.sample_files;if(!u||!u.filename_disk)return t.status(404).json({error:"ZIP file not found"});const d=n(process.cwd(),"uploads"),E=n(d,u.filename_disk),m=new Q(E).getEntries(),h=[];return m.forEach(e=>{if(!e.isDirectory&&e.entryName.toLowerCase().endsWith(".wav")){const t=n("/",e.entryName).split("/").pop();h.push({name:t,path:e.entryName,size:e.header.size})}}),t.json({voicebank:l.name,totalFiles:h.length,files:h})}catch(e){return console.error("Error extracting voicebank files:",e),t.status(500).json({error:"Failed to extract voicebank files",details:e.message})}})}export{ee as default};
